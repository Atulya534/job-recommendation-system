from flask import Flask, request, jsonify
import pandas as pd
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.metrics.pairwise import cosine_similarity
import re
from flask_cors import CORS

app = Flask(__name__)
CORS(app)

DATA_PATH = r'C:\vscode\python_pbl\synthetic_resumes.csv'
resumes = pd.read_csv(DATA_PATH)

def process_text(text):
    text = str(text).lower()
    text = re.sub(r'[^a-z0-9\s]', ' ', text)
    text = re.sub(r'\s+', ' ', text).strip()
    return text

def combine_resume_text(df):
    columns_to_use = [col for col in ['name', 'skills', 'projects', 'experience'] if col in df.columns]
    combined = df[columns_to_use].fillna('').agg(' '.join, axis=1)
    return combined.map(process_text)

resume_text = combine_resume_text(resumes)

vectorizer = TfidfVectorizer(stop_words='english', max_features=5000)
resume_tfidf = vectorizer.fit_transform(resume_text)

@app.route("/recommend", methods=["POST"])
def recommend():
    data = request.json
    job_title = data.get("title", "")
    job_skills = data.get("skills", "")

   
    job_text = f"{job_title} {job_skills}"
    job_text_clean = process_text(job_text)

    job_vector = vectorizer.transform([job_text_clean])
    similarity_scores = cosine_similarity(job_vector, resume_tfidf)[0]
    top_indices = similarity_scores.argsort()[-3:][::-1]

    top_results = []
    for idx in top_indices:
        resume_data = resumes.iloc[idx].to_dict()
        resume_data["similarity"] = round(float(similarity_scores[idx]), 4)
        top_results.append(resume_data)

    return jsonify(top_results)

if __name__ == "__main__":
    app.run(debug=True)
